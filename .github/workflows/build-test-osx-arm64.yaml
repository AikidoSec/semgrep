# This workflow builds and tests the semgrep-core binary for macOS arm64
# and generates the arm64-wheel for pypi.

# coupling: if you modify this file, modify also build-test-osx-x86.yaml
# This file is mostly a copy-paste of build-test-osx-x86.yaml
name: build-test-osx-arm64

on:
  workflow_dispatch:
    inputs:
      use-cache:
        description: "Use Opam Cache - uncheck the box to disable use of the opam cache, meaning a long-running but completely from-scratch build."
        required: true
        type: boolean
        default: true
  workflow_call:
    inputs:
      use-cache:
        description: "Use Opam Cache - uncheck the box to disable use of the opam cache, meaning a long-running but completely from-scratch build."
        required: false
        type: boolean
        default: true

jobs:
  build-osx-arm64:
    uses: ./.github/workflows/build-test-osx.yaml
    secrets: inherit
    with:
      runs-on: "['self-hosted','macOS','ARM64','ghcr.io/cirruslabs/macos-monterey-xcode:latest']"
      architecture: "arm64"
      wheel-artifact-name: osx-arm64-wheel
      wheel-plat-name: macosx_11_0_arm64
      use-cache: ${{ inputs.use-cache }}
