# This workflow performs additional tasks on a PR when
# someone (or start-release.yml) push to a vXXX branch.
# Those tasks are to push a new develop docker image, create
# release artifacts with the Linux and MacOS semgrep packages,
# update PyPy and homebrew, etc.

name: tests

on:
  workflow_dispatch:
  push:
    branches:
      # Sequence of patterns matched against refs/tags
      - "**-test-release"
    tags:
      - "v*" # Push events to matching v*, i.e. v1.0, v20.15.10

jobs:
  test-macos-release:
    name: test macOS release
    runs-on: macos-12
    steps:
      - name: install package
        run: pip3 install semgrep==1.5.1
      - name: test package
        run: semgrep --version
      - name: e2e semgrep-core test
        run: echo '1 == 1' | semgrep -l python -e '$X == $X' -
      - name: e2e spacegrep test
        run: echo '1 == 1' | semgrep -l generic -e '$X == $X' -
